{% extends "layout.html" %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Settings</title>
  <!-- Bootstrap 5 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <style>
    /* Example custom styling */
    body {
      background-color: #f8f9fa;
      margin-top: 1rem;
    }
    .navbar-brand {
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .table th,
    .table td {
      vertical-align: middle;
    }
    .role-dropdown {
      max-width: 180px;
    }
  </style>
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        Admin Dashboard
      </a>
      <ul class="navbar-nav ms-auto">
        <!-- Example: link back to home, or other pages -->
        <li class="nav-item">
          <a class="nav-link" href="/">Back to Home</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- PAGE HEADER -->
  <div class="container">
    <div class="row mb-4">
      <div class="col text-center">
        <h1>User Management</h1>
        <p class="text-secondary">
          Manage user roles and permissions
        </p>
      </div>
    </div>

    <!-- FLASH MESSAGES (OPTIONAL) -->
    {% if get_flashed_messages() %}
      {% for message in get_flashed_messages() %}
        <div class="alert alert-info" role="alert">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- USERS TABLE -->
    <div class="row">
      <div class="col">
        <table class="table table-bordered table-striped table-hover align-middle">
          <thead class="table-dark">
            <tr>
              <th style="width: 5%">ID</th>
              <th style="width: 40%">Email</th>
              <th style="width: 30%">Role</th>
              <th style="width: 25%">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
              <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.email }}</td>
                <td>
                  <!-- Show current role in text or as read-only? 
                       Here, we'll just show text. -->
                  <span class="badge bg-primary">{{ user.role }}</span>
                </td>
                <td>
                  <!-- FORM to update role -->
                  <form 
                    action="{{ url_for('admin_update_role') }}" 
                    method="POST" 
                    class="d-flex align-items-center"
                  >
                    <input type="hidden" name="user_id" value="{{ user.id }}">
                    <select
                      name="role"
                      class="form-select form-select-sm role-dropdown me-2"
                    >
                      <!-- Optionally, generate these from a roles list -->
                      <option value="admin"
                        {% if user.role == "admin" %} selected {% endif %}
                      >admin</option>
                      <option value="member"
                        {% if user.role == "member" %} selected {% endif %}
                      >member</option>
                      <option value="reader"
                        {% if user.role == "reader" %} selected {% endif %}
                      >reader</option>
                    </select>
                    <button class="btn btn-success btn-sm" type="submit">
                      Update
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- POTENTIAL FOR ADDING NEW USERS (Optional) -->
  
    <div class="row mt-4">
      <div class="col">
        <h5>Add New User</h5>
        <form action="/admin-add-user" method="POST" class="row gy-2 gx-3 align-items-center">
          <div class="col-auto">
            <input 
              type="text" 
              class="form-control" 
              name="new_email" 
              placeholder="Enter email" 
              required
            >
          </div>
          <div class="col-auto">
            <select name="new_role" class="form-select" required>
              <option value="reader" selected>reader</option>
              <option value="member">member</option>
              <option value="admin">admin</option>
            </select>
          </div>
          <div class="col-auto">
            <button type="submit" class="btn btn-primary">Add User</button>
          </div>
        </form>
      </div>
    </div>
    

  </div>

  <!-- Bootstrap 5 JS -->
  <script 
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
  </script>
</body>
</html>
{% endblock %}