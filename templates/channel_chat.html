{% extends "layout.html" %}
{% block content %}



<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Chat with Channel {{ channel_name }}</title>
</head>
<body>
    <h1>Chat with Channel: {{ channel_name }}</h1>

    <div>
      <textarea id="userQuery" rows="3" cols="60" placeholder="Enter your question..."></textarea><br/>
      <button id="sendBtn">Send</button>
    </div>
    <div id="chatResult" style="margin-top:20px; border:1px solid #ccc; padding:10px;">
      <!-- Response from the server -->
    </div>
    <h3>Videos in this Channel:</h3>
    <ul>
      {% for item in video_data %}
      {% set vid = item.video %}
        <li>
            <a href="https://www.youtube.com/watch?v={{ vid.video_id }}" target="_blank">
                <svg  style="fill:#333;height:1em; width:1em;" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 48 48" xml:space="preserve">
                    <use href="#icon-summarizeYouTube" xlink:href="#icon-summarizeYouTube"></use>
            </svg></a>
            &nbsp;
            <a href="/chat-video/{{ vid.video_id }}"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"><path d="M240-400h320v-80H240v80Zm0-120h480v-80H240v80Zm0-120h480v-80H240v80ZM80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm126-240h594v-480H160v525l46-45Zm-46 0v-480 480Z"/></svg></a>


            {% if item.summaries_by_type %}
            {% for stype, sumlist in item.summaries_by_type.items() %}
            {% for s in sumlist %}
            <a href="/view-summary/{{ s.id }}">

                <!--View {{ stype|capitalize }} Summary (Model: {{ s.model_name }})-->
                <svg  style="fill:#333;height:1em; width:1em;" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 48 48" xml:space="preserve">
                    <use href="#icon-ollama" xlink:href="#icon-ollama"></use>
            </svg>
              </a>
              {% endfor %}
                {% endfor %}
                {% endif %}


          {{ vid.title }} <!-- , uploaded on {{ vid.upload_date }} -->
          
          


        </li>
      {% endfor %}
    </ul>

<script>
document.getElementById('sendBtn').addEventListener('click', async () => {
  const query = document.getElementById('userQuery').value.trim();
  if (!query) return;

  // Show a "Processing..." message
  const chatDiv = document.getElementById('chatResult');
  chatDiv.innerHTML = "Processing...";

  try {
    const resp = await fetch(`/api/chat-channel/{{ channel_name }}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query })
    });
    const data = await resp.json();
    chatDiv.innerHTML = data.answer;
  } catch (err) {
    chatDiv.innerHTML = "Error: " + err;
  }
});
</script>

</body>
</html>

{% endblock %}